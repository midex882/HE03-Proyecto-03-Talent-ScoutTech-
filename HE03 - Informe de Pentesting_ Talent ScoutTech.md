# INFORME DE AUDITORÍA DE SEGURIDAD (PENTESTING)
**Proyecto:** Talent ScoutTech Web Application
**Fecha:** 14 de Enero de 2026
**Auditor:** Jose Escalón Prada


## 1. Resumen Ejecutivo
Se ha realizado una auditoría de seguridad sobre la aplicación web **Talent ScoutTech** con el objetivo de identificar vulnerabilidades, evaluar su impacto y proponer medidas correctivas.

Durante el análisis, se han detectado fallos de seguridad críticos que comprometen totalmente la confidencialidad, integridad y disponibilidad del sistema. Los hallazgos más graves incluyen:
*   **Inyección SQL (SQLi):** Permite el acceso no autorizado sin contraseña y la suplantación de identidad en comentarios.
*   **Cross-Site Scripting (XSS) Almacenado:** Permite la ejecución de código malicioso en navegadores de terceros.
*   **Cross-Site Request Forgery (CSRF):** Permite realizar transacciones económicas fraudulentas sin consentimiento del usuario.
*   **Gestión de Sesiones Rota:** Almacenamiento de credenciales en texto plano en cookies y falta de validación de sesión.

Se recomienda una intervención inmediata en el código fuente (saneamiento de entradas) y en la configuración del servidor web para mitigar estos riesgos.



## 2. Alcance y Metodología
*   **Objetivo:** Identificar vulnerabilidades explotables en la aplicación web local.
*   **Metodología:** Caja Negra (Black Box) y Caja Gris (Gray Box) con revisión de código fuente.
*   **Vectores analizados:** Autenticación, validación de entradas (SQLi, XSS), gestión de sesiones, configuración del servidor y lógica de negocio (CSRF).


## 3. Hallazgos Técnicos Detallados

### 3.1. [CRÍTICO] Inyección SQL (SQLi) en Login
**Descripción:**
El formulario de inicio de sesión (`insert_player.php` y mecanismos de auth) concatena directamente la entrada del usuario en la consulta a la base de datos sin utilizar sentencias preparadas. El uso de `SQLite3::escapeString()` resulta ineficaz debido al uso de comillas dobles en la query original.

**Evidencia / Prueba de Concepto (PoC):**
*   **Bypass de Autenticación:** Al introducir el usuario `'` (comilla simple) se rompe la sintaxis, revelando errores de base de datos.
*   **Extracción de Credenciales:** Mediante un script de fuerza bruta combinado con inyección (blind SQLi boolean-based), se logró identificar un usuario válido omitiendo la validación de nombre.
    *   *Payload:* `" OR 1=1 LIMIT 1 OFFSET 1 -- -`
    *   *Contraseña descubierta:* `1234`

**Impacto:**
Acceso administrativo o de usuario legítimo sin credenciales, posible extracción completa de la base de datos.

**Recomendación:**
Implementar **Consultas Preparadas (Prepared Statements)** en todas las interacciones con la base de datos. Evitar la concatenación de cadenas. [ppl-ai-file-upload.s3.amazonaws](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/133478932/463a345c-040b-4bd5-88cb-5dc12b36be7b/HE03-Proyecto-03_-Talent-ScoutTech.md)

 

### 3.2. Inyección SQL e IDOR en Comentarios
**Descripción:**
El archivo `add_comment.php` recibe el parámetro `id` por GET y lo inserta directamente en la base de datos sin validación. Esto permite inyectar SQL para modificar el `userId` asociado al comentario.

**Evidencia (PoC):**
Se localizó el archivo de respaldo `add_comment.php~` mediante *fuzzing*, revelando la consulta vulnerable.
*   *Payload URL:* `http://localhost/web/add_comment.php?id=3', '1', 'Hacked Comment') -- -`
*   **Resultado:** Se publica un comentario en nombre del usuario con ID 1 (posible administrador) sin estar autenticado como él.

**Impacto:**
Suplantación de identidad (Spoofing) y corrupción de la integridad de los datos.

**Recomendación:**
Utilizar parámetros vinculados (bind parameters) y validar que el `id` recibido corresponda a la sesión activa, no a un parámetro GET manipulable.

 

### 3.3.   Cross-Site Scripting (XSS) Almacenado
**Descripción:**
La aplicación no sanea las entradas de usuario antes de almacenarlas ni escapa los caracteres especiales al mostrarlos en el navegador. Esto afecta a los módulos de comentarios (`show_comments.php`) y listado de jugadores (`list_players.php`).

**Evidencia (PoC):**
*   **Inyección:** Se introduce `<script>alert('test xss');</script>` en el cuerpo del comentario.
*   **Ejecución:** Al visitar la sección de comentarios o el listado de jugadores, el código JavaScript se ejecuta automáticamente.

**Impacto:**
Robo de cookies de sesión (Session Hijacking), redirecciones maliciosas y ejecución de ataques CSRF invisibles contra otros usuarios.

**Recomendación:**
Aplicar la función `htmlspecialchars($variable, ENT_QUOTES, 'UTF-8')` en todas las salidas de datos (`echo`) hacia el navegador.

 

### 3.4.   Cross-Site Request Forgery (CSRF) en Pagos
**Descripción:**
La plataforma de pagos (`web.pagos`) confía únicamente en las cookies de sesión para validar transacciones, sin tokens anti-CSRF. Un atacante puede forzar al navegador de una víctima a realizar donaciones no deseadas.

**Evidencia (PoC):**
Se combinó la vulnerabilidad XSS con CSRF para crear un ataque invisible ("drive-by").
*   *Payload:*
    ```html
    <img src="http://web.pagos/donate.php?amount=100&receiver=attacker"
         width="0" height="0" style="display:none;" />
    ```
*   **Resultado:** Al cargar el comentario infectado, el navegador de la víctima realiza la petición GET transfiriendo fondos automáticamente.

**Impacto:**
Pérdida económica directa para los usuarios y fraude financiero.

**Recomendación:**
Implementar **Tokens Anti-CSRF** (sincronizados) en todos los formularios de estado y exigir re-autenticación para operaciones críticas. Cambiar métodos GET por POST para acciones de cambio de estado.

 

### 3.5. Gestión de Sesiones y Autenticación Insegura
**Descripción:**
*   **Credenciales en Texto Plano:** El archivo `auth.php` almacena usuario y contraseña directamente en cookies (`$_COOKIE['password']`).
*   **Registro Público:** `register.php` es accesible sin restricciones ni validación de complejidad de contraseñas.
*   **Secuestro de Sesión:** La sesión depende de una cookie `userId` manipulable.

**Recomendación:**
*   Utilizar **Sesiones de Servidor (`$_SESSION`)** y almacenar solo el ID de sesión (`PHPSESSID`) en el cliente.
*   Configurar cookies con banderas `HttpOnly` y `Secure`.
*   Implementar hash de contraseñas (ej. `password_hash()` con bcrypt/argon2).


### 3.6. Configuración de Servidor y Fugas de Información
**Descripción:**
*   **Archivos de Respaldo:** Se detectó acceso a `add_comment.php~`, revelando código fuente.
*   **Directory Listing:** El servidor lista el contenido de directorios sin `index.php`.
*   **Cabeceras:** Apache expone versión y SO (`ServerSignature`).

**Recomendación:**
*   Configurar Apache: `ServerTokens Prod`, `ServerSignature Off`, `Options -Indexes`.
*   Bloquear acceso a archivos sensibles (`.php~`, `.bak`, `.sql`) mediante `.htaccess`.


## 4. Conclusión
La aplicación **Talent ScoutTech** presenta un estado de seguridad deficiente con vulnerabilidades críticas en todas las capas principales (Base de Datos, Aplicación, Servidor). Es imperativo no poner el sistema en producción hasta corregir los fallos de Inyección SQL y XSS, así como reescribir el mecanismo de autenticación para abandonar el uso de cookies inseguras.


### Tabla Resumen de Vulnerabilidades

| Vulnerabilidad | Ubicación | Solución Principal |
| :--- | :--- | :--- |
| **Inyección SQL** | `insert_player.php`, `add_comment.php` | Sentencias Preparadas |
| **XSS Almacenado** | `show_comments.php`, `list_players.php` | `htmlspecialchars()` |
| **CSRF** | `donate.php` (vía XSS) | Tokens Anti-CSRF |
| **Auth Insegura** | `auth.php`, Cookies | Uso de `$_SESSION` |
| **Info Leakage** | Archivos `~`, Cabeceras | Hardening Apache (.htaccess) |
